<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Teacher â€” QR Generator</title>
  <style>
    body{font-family:sans-serif;background:#f4f6f9;padding:20px}
    .box{max-width:700px;margin:auto;background:#fff;padding:20px;border-radius:10px;box-shadow:0 4px 12px rgba(0,0,0,0.1)}
    h1{margin-top:0}
    input,button{padding:8px;margin:4px}
    canvas{margin:10px 0;border:1px solid #ddd;border-radius:8px}
    button{border:0;border-radius:6px;background:#1f6feb;color:#fff;cursor:pointer}
    button.ghost{background:#ddd;color:#111}
    #protected{display:none}
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
</head>
<body>
  <div class="box">
    <h1>Teacher Panel â€” QR Generator</h1>

    <!-- Login -->
    <div id="login">
      <p><b>Teacher Password Required</b></p>
      <input id="pass" type="password" placeholder="Enter password"/>
      <button id="loginBtn">Login</button>
      <p id="loginStatus" style="color:red"></p>
    </div>

    <!-- Protected content -->
    <div id="protected">
      <h3>Generate QR</h3>
      <input id="genRoll" type="text" placeholder="Roll"/>
      <input id="genName" type="text" placeholder="Name"/>
      <button id="genBtn">Generate</button>
      <a id="downloadBtn" href="#" download style="display:none">Download QR</a>
      <canvas id="qrCanvas" width="250" height="250"></canvas>

      <hr/>
      <h3>Student List</h3>
      <input type="file" id="studentFile" accept=".csv"/>
      <button id="importBtn">Import CSV</button>
      <button id="exportBtn">Export CSV</button>
      <ul id="students"></ul>
    </div>
  </div>

<script>
document.addEventListener('DOMContentLoaded', ()=>{
  const PASSWORD="teacher123"; // ðŸ”‘ change this

  const loginDiv=document.getElementById('login');
  const protectedDiv=document.getElementById('protected');
  const loginBtn=document.getElementById('loginBtn');
  const pass=document.getElementById('pass');
  const loginStatus=document.getElementById('loginStatus');

  loginBtn.onclick=()=>{
    if(pass.value===PASSWORD){
      loginDiv.style.display="none";
      protectedDiv.style.display="block";
    }else{
      loginStatus.textContent="Wrong password!";
    }
  };

  // Storage helpers
  const STU_KEY='qr_students_v1';
  function load(){return JSON.parse(localStorage.getItem(STU_KEY)||'[]');}
  function save(v){localStorage.setItem(STU_KEY,JSON.stringify(v));render();}
  function render(){
    const arr=load();
    students.innerHTML='';
    arr.forEach(s=>{
      const li=document.createElement('li');
      li.textContent=`${s.roll} â€” ${s.name}`;
      students.appendChild(li);
    });
  }

  // QR generation
  genBtn.onclick=()=>{
    const roll=genRoll.value.trim();
    const name=genName.value.trim();
    if(!roll||!name){alert("Enter roll and name");return;}
    const stu=load();
    if(stu.find(s=>s.roll===roll)){
      alert("QR already exists for this roll!");return;
    }
    stu.push({roll,name});
    save(stu);
    new QRious({element:qrCanvas,value:`${roll}|${name}`,size:250});
    const url=qrCanvas.toDataURL();
    downloadBtn.href=url;downloadBtn.style.display="inline-block";
  };

  // Import/export
  importBtn.onclick=()=>{
    const f=studentFile.files[0];if(!f)return;
    const reader=new FileReader();
    reader.onload=e=>{
      const lines=e.target.result.trim().split(/\r?\n/);
      const stu=load();
      lines.forEach(line=>{
        const [roll,name]=line.split(',');
        if(roll&&name&&!stu.find(s=>s.roll===roll.trim())){
          stu.push({roll:roll.trim(),name:name.trim()});
        }
      });
      save(stu);
    };
    reader.readAsText(f);
  };

  exportBtn.onclick=()=>{
    const stu=load();
    let csv="roll,name\n";
    stu.forEach(s=>{csv+=`${s.roll},${s.name}\n`;});
    const blob=new Blob([csv],{type:'text/csv'});
    const url=URL.createObjectURL(blob);
    const a=document.createElement('a');
    a.href=url;a.download="students.csv";a.click();
    URL.revokeObjectURL(url);
  };

  render();
});
</script>
</body>
</html>
